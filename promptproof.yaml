schema_version: pp.v1
fixtures: fixtures/support-replies/outputs.jsonl
selectors:
  text: output.text
  json: output.json
  tools: output.tool_calls
  locale: locale

checks:
  - id: schema
    type: json_schema
    target: json
    schema:
      type: object
      required: [status, items, confidence]
      properties:
        status: 
          type: string
          enum: [success, error]
        items: 
          type: array
        confidence: 
          type: number
          minimum: 0
          maximum: 1
  - id: no_pii
    type: regex_forbidden
    target: text
    patterns:
      - "[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}"
      - "\\b\\+?\\d[\\d\\s().-]{7,}\\b"
  - id: disclaimer_en
    type: regex_required
    target: text
    patterns: 
      - "We cannot share personal contact information\\."
  - id: disclaimer_fr
    type: regex_required
    target: text
    patterns: 
      - "Nous ne pouvons pas partager des coordonn√©es personnelles\\."

  # Extra checks using new capabilities
  - id: response_contains_disclaimer
    type: string_contains
    target: text
    expected: "We cannot"
    ignore_case: true

  - id: citations_set_allowed
    type: set_equality
    target: json.citations
    expected: ["/data/faq.md", "/data/warranty.md", "/data/refund-policy.md"]
    mode: subset

budgets:
  cost_usd_per_run_max: 0.30
  cost_usd_total_max: 1.50
  latency_ms_p95_max: 1800
  # Optional regression-based budget checks (used when baseline exists)
  cost_usd_total_pct_increase_max: 20
  
mode: gate
